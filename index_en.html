<!DOCTYPE html>
<html lang="pt-br">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1, maximum-scale=1.0">
        <title>Day of the month of dating</title>
        <link rel="stylesheet" type="text/css" href="http://fonts.googleapis.com/css?family=Ubuntu:regular,bold&subset=Latin">
        <link rel="stylesheet" type="text/css" href="/static/style.css">
        <script src="/static/js/main.js"></script>
        <meta charset="utf-8">
    </head>
    <body style="margin: 0;">
    
        <div id="tela_salvar">
            <p>Day of the month of dating</p>
            <p>
                <input type="number" id="day" size="2" maxlength="2" placeholder="day">
                <input type="number" id="month" size="2" maxlength="2" placeholder="month">
                <input type="number" id="year" size="4" maxlength="4" placeholder="year">
                <input type="button" id="salvar" value="Save">
            </p>
        </div>
        <div id="tela_resultado"></div>

        <script>

        var tela_resultado = document.getElementById('tela_resultado');
        var tela_salvar = document.getElementById('tela_salvar');
        var btnSalvar = document.getElementById('salvar');

        var reset = function (){
            console.log('reset');
            localStorage.clear();
            tela_resultado.style.display = "none";
            salvar();
        }

        var resultado = function() {
            var niver = localStorage.getItem('niver');
            console.log('resultado');
            tela_resultado.style.display = "block";
            data = niver.split('/');
            day = data[0];
            month = data[1];
            year = data[2];
            console.log(day);

            function totaldifDate(data1, data2) {
                var birthdayThisYear = new Date(data2.getFullYear(), data1.getMonth(), data1.getDate());
                var year = data2.getFullYear() - data1.getFullYear();

                if(birthdayThisYear > data2) {
                    year--;
                }

                console.log(data1.getMonth());
                console.log(data2.getMonth()+1);

                month = 12-data1.getMonth()+data2.getMonth()+1;
                if ( month > 12 ){
                    month = month - 12;
                } else if( month == 12 ){
                    year++;
                    month = 0;
                }

                if ( month == 0 ){
                    month = '';
                } else {
                    if (month == 1){
                        month = " and " + month + " month";
                    }
                    else {
                        month = " and " + month + " months";
                    }

                }
                if (year > 1)
                    return year + " years" + month + ' of love';
                else
                    return year + " year" + month + ' of love';

            }

            function difDate(data1, data2) {
                return Math.ceil((data1.getTime()-data2.getTime())/1000/60/60/24);
            }

            var resultado = tela_resultado;
            var df = new Date();
            var df = new Date(df.getFullYear(), df.getMonth(), df.getDate());
            var di = new Date(df.getFullYear(), df.getMonth(), day);
            console.log(month);
            var tdi = new Date(year, month, day);
            console.log('data inicial total ' + tdi);
            console.log('data inicial ' + di);
            console.log('data final ' + df);

            if ( di < df ) {
                var di = new Date(df.getFullYear(), df.getMonth()+1, day);
                console.log('data inicial for menor que data final');
            }

            total_days = totaldifDate(tdi, df);
            days = difDate(di, df);

            if ( days == 0 ) {
                resultado.innerHTML = '<p>Congratulation</p><p>' + total_days + '</p>';
            } else {
                if ( days == 1){
                    days = days + " day";
                } else {
                    days = days + " days";
                }
                resultado.innerHTML = "<p>Next birthdate is:</p>"+days+"<p></p>";
            }
            resultado.innerHTML = resultado.innerHTML + '<input type="button" id="reset" value="Edit date">';
            document.getElementById('reset').addEventListener('click', reset);
        }

        var salvar = function (){
            console.log('salvar');
            tela_salvar.style.display = "block";
            function salvar(){
                var day = document.getElementById('day').value;
                var month = document.getElementById('month').value;
                var year = document.getElementById('year').value;

                if ( day && month && year ) {
                    niver = day + '/' + month + "/" + year
                    localStorage.setItem('niver', niver);
                    tela_salvar.style.display = "none";
                    resultado();
                } else {
                    alert('Fill day, month and year');
                }

            }
            btnSalvar.addEventListener('click', salvar);
        }

        var niver = localStorage.getItem('niver');
        if(niver == null) {
            salvar();
        } else {
            resultado();
        }
        </script>
    </body>
</html>
